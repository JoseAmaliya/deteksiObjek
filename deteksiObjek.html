<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Deteksi Objek</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>

<style>
    body { text-align:center; background:#f3f3f3; }
    #container { position:relative; display:inline-block; }
    #canvas { position:absolute; left:0; top:0; }
</style>
</head>
<body>

<h2>Deteksi Objek Real-Time</h2>
<p id="status">Memuat...</p>

<div id="container">
    <video id="video" width="640" height="480" autoplay playsinline muted style="background:black;"></video>
    <canvas id="canvas" width="640" height="480"></canvas>
</div>

<script>
async function startCamera() {
    const video = document.getElementById("video");
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ video:true });
        video.srcObject = stream;

        return new Promise(resolve => {
            video.onloadedmetadata = () => resolve(video);
        });
    } catch (e) {
        document.getElementById("status").innerText = "Akses kamera ditolak!";
        console.log(e);
        return null;
    }
}

async function main() {
    document.getElementById("status").innerText = "Memuat model...";
    const model = await cocoSsd.load();

    document.getElementById("status").innerText = "Mengaktifkan kamera...";
    const video = await startCamera();
    if (!video) return;

    document.getElementById("status").innerText = "Model siap!";

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    async function detect() {
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        const predictions = await model.detect(video);

        predictions.forEach(p => {
            const [x, y, w, h] = p.bbox;

            ctx.strokeStyle = "cyan";
            ctx.lineWidth = 2;
            ctx.strokeRect(x, y, w, h);

            ctx.fillStyle = "cyan";
            ctx.fillText(p.class + " (" + Math.round(p.score*100) + "%)", x, y - 4);
        });

        requestAnimationFrame(detect);
    }

    detect();
}

main();
</script>
</body>
</html>
